<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nepal Accountant Pro</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
:root { --primary:#003893; --success:#28a745; --dark:#1a252f; }
body { margin:0;font-family:Arial;background:#eef2f7; }
.sidebar { width:250px;background:var(--dark);color:white;height:100vh;position:fixed; }
.sidebar button { width:100%;padding:15px;border:none;background:none;color:#bbb;text-align:left;cursor:pointer; }
.sidebar button:hover { background:var(--primary);color:white; }
.main { margin-left:250px;padding:20px; }
.card { background:white;padding:20px;border-radius:10px;margin-bottom:20px; }
input,select,textarea { width:100%;padding:10px;margin:5px 0; }
button.run { background:var(--primary);color:white;padding:10px;border:none;width:100%; }
.result { background:#f0f7ff;padding:10px;margin-top:10px;border-left:4px solid var(--success); }
.calc button { width:24%;padding:15px;margin:1%; }
</style>
</head>

<body>

<div class="sidebar">
<button onclick="show('payroll')">Payroll</button>
<button onclick="show('tax')">VAT / TDS</button>
<button onclick="show('cash')">Cash Recon</button>
<button onclick="show('finance')">Finance</button>
<button onclick="show('date')">Date Convert</button>
<button onclick="show('ai')">AI Advisor</button>
<button onclick="show('calc')">Calculator</button>
</div>

<div class="main">

<!-- Payroll -->
<div id="payroll" class="card">
<h3>Payroll Calculator</h3>
<input type="number" id="salary" placeholder="Monthly Salary">
<select id="ssf"><option value="yes">SSF Yes</option><option value="no">SSF No</option></select>
<button class="run" onclick="calcPayroll()">Calculate</button>
<div id="payrollRes" class="result"></div>
</div>

<!-- VAT -->
<div id="tax" class="card" style="display:none">
<h3>VAT / TDS Engine</h3>
<input type="number" id="amt" placeholder="Amount">
<select id="mode">
<option value="excl">VAT Exclusive</option>
<option value="incl">VAT Inclusive</option>
<option value="net">Reverse TDS</option>
</select>
<input type="number" id="tdsRate" value="1.5">
<button class="run" onclick="calcTax()">Process</button>
<div id="taxRes" class="result"></div>
</div>

<!-- Cash -->
<div id="cash" class="card" style="display:none">
<h3>Cash Denomination</h3>
<div id="denoms"></div>
<input type="number" id="ledger" placeholder="Ledger Balance">
<button class="run" onclick="recon()">Recon</button>
<div id="cashRes" class="result"></div>
</div>

<!-- Finance -->
<div id="finance" class="card" style="display:none">
<h3>Financial Analysis</h3>
<input id="sales" placeholder="Sales">
<input id="exp" placeholder="Expenses">
<input id="assets" placeholder="Assets">
<button class="run" onclick="finance()">Analyze</button>
<div id="finRes" class="result"></div>
</div>

<!-- Date -->
<div id="date" class="card" style="display:none">
<h3>BS ⇄ AD Converter</h3>
<input id="dateIn" placeholder="2082-01-01 OR 2025-04-14">
<button class="run" onclick="convert()">Convert</button>
<div id="dateRes" class="result"></div>
</div>

<!-- AI -->
<div id="ai" class="card" style="display:none">
<h3>AI Accountant</h3>
<input type="password" id="apiKey" placeholder="OpenRouter API Key">
<textarea id="q" placeholder="Ask accounting question"></textarea>
<button class="run" onclick="ask()">Ask AI</button>
<div id="aiRes" class="result"></div>
</div>

<!-- Calculator -->
<div id="calc" class="card" style="display:none">
<h3>Calculator</h3>
<input id="screen" value="0">
<div class="calc">
<button onclick="p('7')">7</button><button onclick="p('8')">8</button><button onclick="p('9')">9</button><button onclick="p('/')">÷</button>
<button onclick="p('4')">4</button><button onclick="p('5')">5</button><button onclick="p('6')">6</button><button onclick="p('*')">×</button>
<button onclick="p('1')">1</button><button onclick="p('2')">2</button><button onclick="p('3')">3</button><button onclick="p('-')">-</button>
<button onclick="p('0')">0</button><button onclick="p('.')">.</button><button onclick="solve()">=</button><button onclick="clr()">C</button>
</div>
</div>

</div>

<script>
// navigation
function show(id){
document.querySelectorAll('.card').forEach(c=>c.style.display='none');
document.getElementById(id).style.display='block';
}

// payroll
function calcPayroll(){
let s=+salary.value;
let ssfDed=(ssf.value==='yes')?s*0.11:0;
let annual=(s-ssfDed)*12;
let tax=annual>500000?(annual-500000)*0.1:0;
payrollRes.innerHTML=`SSF: ${ssfDed.toFixed(2)} | Annual: ${annual.toFixed(2)} | Tax: ${tax.toFixed(2)}`;
}

// vat/tds
function calcTax(){
let a=+amt.value;
let r=(+tdsRate.value)/100;
let base,vat,tds;
if(mode.value==='excl'){ base=a; vat=a*0.13; }
if(mode.value==='incl'){ base=a/1.13; vat=a-base; }
if(mode.value==='net'){ base=a/(1-r); vat=base*0.13; }
tds=base*r;
taxRes.innerHTML=`Base:${base.toFixed(2)} VAT:${vat.toFixed(2)} TDS:${tds.toFixed(2)} Net:${(base+vat-tds).toFixed(2)}`;
}

// cash
[1000,500,100,50,20,10,5,2,1].forEach(n=>{
denoms.innerHTML+=`Rs ${n} × <input type='number' class='q' data-v='${n}'><br>`;
});

function recon(){
let total=0;
document.querySelectorAll('.q').forEach(i=>total+=(+i.value||0)*i.dataset.v);
let diff=total-(+ledger.value||0);
cashRes.innerHTML=`Physical:${total} Difference:${diff}`;
}

// finance
function finance(){
let p=sales.value-exp.value;
let margin=(p/sales.value)*100;
let roa=(p/assets.value)*100;
finRes.innerHTML=`Profit:${p} Margin:${margin.toFixed(2)}% ROA:${roa.toFixed(2)}%`;
}

// date convert
function convert(){
let d=dateIn.value.split('-');
let y=+d[0];
if(y>2000){ dateRes.innerHTML=`AD ≈ ${y-56}-${d[1]}-${d[2]}`;}
else{ dateRes.innerHTML=`BS ≈ ${y+56}-${d[1]}-${d[2]}`;}
}

// calculator
function p(v){ screen.value=(screen.value==='0')?v:screen.value+v;}
function clr(){screen.value='0';}
function solve(){screen.value=eval(screen.value);}

// AI memory chat
let history=[];
async function ask(){
localStorage.setItem('key',apiKey.value);
history.push({role:"user",content:q.value});

let res=await fetch("https://openrouter.ai/api/v1/chat/completions",{
method:"POST",
headers:{
"Authorization":"Bearer "+localStorage.getItem('key'),
"Content-Type":"application/json"
},
body:JSON.stringify({model:"mistralai/mistral-7b-instruct:free",messages:history})
});

let data=await res.json();
let reply=data.choices[0].message.content;
history.push({role:"assistant",content:reply});
aiRes.innerHTML=marked.parse(reply);
}
</script>

</body>
</html>