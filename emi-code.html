<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EMI Analytics Tool – Kushal Phuyal</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
:root{
  --ink:#070810;--card:#0e1428;--card2:#111828;
  --line:rgba(255,255,255,0.07);--glass:rgba(255,255,255,0.04);
  --teal:#00e5cc;--violet:#7c5cfc;--rose:#ff6584;--gold:#ffd166;
  --text:#d4d8f0;--muted:#5a6080;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--ink);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;overflow-x:hidden;}

body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.03;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)'/%3E%3C/svg%3E");}

/* BLOBS */
.blob{position:fixed;border-radius:50%;filter:blur(130px);opacity:.12;pointer-events:none;z-index:0;}
.b1{width:500px;height:500px;background:var(--violet);top:-200px;left:-150px;}
.b2{width:400px;height:400px;background:var(--teal);bottom:-150px;right:-100px;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:9999;height:66px;display:flex;align-items:center;
  justify-content:space-between;padding:0 6%;background:rgba(7,8,16,.85);
  backdrop-filter:blur(20px);border-bottom:1px solid var(--line);}
.nav-logo{font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:800;
  letter-spacing:.1em;color:white;text-decoration:none;}
.nav-logo em{color:var(--teal);font-style:normal;}
.nav-back{display:flex;align-items:center;gap:8px;color:var(--muted);text-decoration:none;
  font-size:.875rem;font-weight:500;padding:8px 16px;border-radius:8px;
  border:1px solid var(--line);transition:all .25s;}
.nav-back:hover{color:var(--teal);border-color:var(--teal);transform:translateX(-3px);}

/* PAGE */
.page{max-width:1100px;margin:0 auto;padding:90px 5% 80px;position:relative;z-index:1;}

/* HEADER */
.page-header{text-align:center;margin-bottom:50px;}
.eyebrow{font-size:.72rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;
  color:var(--teal);display:inline-flex;align-items:center;gap:10px;margin-bottom:16px;}
.eyebrow::before,.eyebrow::after{content:'';width:28px;height:1px;background:var(--teal);}
.page-header h1{font-family:'Syne',sans-serif;font-size:clamp(2rem,4vw,3rem);
  font-weight:800;color:white;margin-bottom:10px;}
.page-header h1 span{background:linear-gradient(100deg,var(--teal),var(--violet));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.page-header p{color:var(--muted);font-size:.95rem;}

/* CARD */
.card{background:var(--card);border:1px solid var(--line);border-radius:20px;padding:32px;}

/* INPUTS */
.inputs-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:28px;}
.inp-group label{display:block;font-size:.8rem;font-weight:600;color:var(--muted);
  text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px;}
.inp-wrap{position:relative;}
.inp-wrap .prefix{position:absolute;left:14px;top:50%;transform:translateY(-50%);
  color:var(--muted);font-size:.9rem;pointer-events:none;}
.inp-wrap .suffix{position:absolute;right:14px;top:50%;transform:translateY(-50%);
  color:var(--muted);font-size:.8rem;pointer-events:none;}
.inp-wrap input{width:100%;padding:13px 40px 13px 36px;background:rgba(0,0,0,.3);
  border:1px solid var(--line);border-radius:11px;color:white;outline:none;
  font-family:'DM Sans',sans-serif;font-size:.95rem;transition:border-color .25s;}
.inp-wrap input:focus{border-color:var(--teal);}
.inp-wrap input::placeholder{color:var(--muted);}
.inp-wrap input::-webkit-inner-spin-button{-webkit-appearance:none;}

/* ADJUSTABLE CHARGES */
.charges-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:28px;}
.charge-box{background:rgba(0,0,0,.2);border:1px solid var(--line);border-radius:14px;padding:18px 20px;}
.charge-box .charge-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.charge-box .charge-label{font-size:.78rem;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;}
.charge-val-display{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;color:var(--teal);}
input[type=range]{width:100%;-webkit-appearance:none;height:4px;background:var(--line);
  border-radius:2px;outline:none;cursor:pointer;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;
  border-radius:50%;background:var(--teal);cursor:pointer;border:2px solid var(--ink);}
.charge-hint{font-size:.72rem;color:var(--muted);margin-top:6px;}

/* BUTTONS */
.btn-row{display:flex;gap:14px;}
.btn{display:flex;align-items:center;justify-content:center;gap:9px;
  padding:14px 32px;border-radius:12px;font-weight:700;font-size:.95rem;
  font-family:'DM Sans',sans-serif;cursor:pointer;border:none;transition:all .28s;}
.btn-calc{flex:1;background:var(--teal);color:var(--ink);}
.btn-calc:hover{transform:translateY(-3px);box-shadow:0 10px 28px rgba(0,229,204,.35);}
.btn-reset{background:rgba(255,255,255,.05);border:1px solid var(--line);color:var(--muted);}
.btn-reset:hover{border-color:var(--rose);color:var(--rose);}
.btn-print{background:rgba(255,255,255,.05);border:1px solid var(--line);color:var(--muted);}
.btn-print:hover{border-color:var(--violet);color:var(--violet);}

/* ERROR */
.error-msg{display:none;color:var(--rose);font-size:.85rem;margin-top:12px;
  padding:10px 16px;background:rgba(255,101,132,.08);border:1px solid rgba(255,101,132,.2);
  border-radius:8px;}

/* RESULTS */
#results{margin-top:40px;display:none;}

/* SUMMARY CARDS */
.summary-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:30px;}
.sum-card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:22px;
  transition:border-color .3s;}
.sum-card:hover{border-color:rgba(0,229,204,.3);}
.sum-card .label{font-size:.75rem;color:var(--muted);text-transform:uppercase;
  letter-spacing:.08em;margin-bottom:8px;}
.sum-card .value{font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:white;}
.sum-card .sub{font-size:.78rem;color:var(--muted);margin-top:4px;}
.sum-card.highlight{border-color:rgba(0,229,204,.3);background:rgba(0,229,204,.05);}
.sum-card.highlight .value{color:var(--teal);}

/* CHART + BREAKDOWN */
.visual-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px;}
.chart-card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:24px;}
.chart-card h3{font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;
  color:white;margin-bottom:20px;}
.chart-wrap{position:relative;height:220px;display:flex;align-items:center;justify-content:center;}
.breakdown-list{display:flex;flex-direction:column;gap:14px;margin-top:10px;}
.bk-item{display:flex;align-items:center;gap:12px;}
.bk-dot{width:12px;height:12px;border-radius:3px;flex-shrink:0;}
.bk-label{font-size:.82rem;color:var(--muted);flex:1;}
.bk-value{font-weight:600;font-size:.9rem;color:white;}
.bk-bar-wrap{width:100%;height:5px;background:var(--line);border-radius:3px;margin-top:4px;overflow:hidden;}
.bk-bar{height:100%;border-radius:3px;transition:width .8s ease;}

/* TABLE */
.table-section{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;}
.table-head{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;
  border-bottom:1px solid var(--line);}
.table-head h3{font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;color:white;}
.table-scroll{max-height:360px;overflow-y:auto;}
.table-scroll::-webkit-scrollbar{width:4px;}
.table-scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:2px;}
table{width:100%;border-collapse:collapse;}
thead th{background:rgba(0,0,0,.3);color:var(--muted);font-size:.75rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.06em;padding:12px 16px;text-align:right;
  position:sticky;top:0;border-bottom:1px solid var(--line);}
thead th:first-child{text-align:center;}
tbody tr{border-bottom:1px solid var(--line);transition:background .2s;}
tbody tr:hover{background:rgba(255,255,255,.03);}
tbody td{padding:11px 16px;font-size:.85rem;text-align:right;color:var(--text);}
tbody td:first-child{text-align:center;color:var(--muted);}
tbody td:nth-child(3){color:#a8e6cf;}
tbody td:nth-child(4){color:#ff8b94;}

/* PRINT */
@media print{
  body{background:white;color:#000;}
  nav,.blob,body::before,.btn-row{display:none!important;}
  .card,.table-section,.sum-card,.chart-card{background:white!important;border:1px solid #ddd!important;color:#000!important;}
  .sum-card .value,.chart-card h3,.table-head h3,.page-header h1{color:#000!important;}
  #results{display:block!important;}
  .table-scroll{max-height:none!important;overflow:visible!important;}
}

/* RESPONSIVE */
@media(max-width:900px){
  .inputs-grid{grid-template-columns:1fr 1fr;}
  .summary-grid{grid-template-columns:1fr 1fr;}
  .visual-row{grid-template-columns:1fr;}
}
@media(max-width:600px){
  .inputs-grid{grid-template-columns:1fr;}
  .charges-row{grid-template-columns:1fr;}
  .summary-grid{grid-template-columns:1fr;}
  .btn-row{flex-direction:column;}
  nav{padding:0 5%;}
}
</style>
</head>
<body>
<div class="blob b1"></div>
<div class="blob b2"></div>

<!-- NAV -->
<nav>
  <a href="index.html" class="nav-logo">KUSHAL<em>.</em>P</a>
  <a href="index.html" class="nav-back"><i class="fas fa-arrow-left"></i> Back to Portfolio</a>
</nav>

<div class="page">
  <!-- HEADER -->
  <div class="page-header">
    <div class="eyebrow">Finance Tool</div>
    <h1>EMI <span>Analytics Tool</span></h1>
    <p>Advanced loan calculation with amortization schedule & visual breakdown</p>
  </div>

  <!-- INPUT CARD -->
  <div class="card">
    <div class="inputs-grid">
      <div class="inp-group">
        <label>Principal Amount</label>
        <div class="inp-wrap">
          <span class="prefix">Rs</span>
          <input type="number" id="principal" placeholder="e.g. 500000" min="1">
        </div>
      </div>
      <div class="inp-group">
        <label>Annual Interest Rate</label>
        <div class="inp-wrap">
          <span class="prefix"><i class="fas fa-percent" style="font-size:.75rem"></i></span>
          <input type="number" id="rate" step="0.01" placeholder="e.g. 12" min="0.01">
          <span class="suffix">% p.a.</span>
        </div>
      </div>
      <div class="inp-group">
        <label>Loan Tenure</label>
        <div class="inp-wrap">
          <span class="prefix"><i class="fas fa-calendar" style="font-size:.75rem"></i></span>
          <input type="number" id="months" placeholder="e.g. 36" min="1">
          <span class="suffix">months</span>
        </div>
      </div>
    </div>

    <!-- ADJUSTABLE CHARGES -->
    <div class="charges-row">
      <div class="charge-box">
        <div class="charge-header">
          <span class="charge-label"><i class="fas fa-cog"></i> Service Charge</span>
          <span class="charge-val-display" id="scDisplay">1.30%</span>
        </div>
        <input type="range" id="scRange" min="0" max="5" step="0.05" value="1.3"
          oninput="document.getElementById('scDisplay').textContent=parseFloat(this.value).toFixed(2)+'%'">
        <div class="charge-hint">Default: 1.30% of principal — slide to adjust</div>
      </div>
      <div class="charge-box">
        <div class="charge-header">
          <span class="charge-label"><i class="fas fa-shield-alt"></i> Insurance Charge</span>
          <span class="charge-val-display" id="icDisplay">0.425%</span>
        </div>
        <input type="range" id="icRange" min="0" max="2" step="0.025" value="0.425"
          oninput="document.getElementById('icDisplay').textContent=parseFloat(this.value).toFixed(3)+'%'">
        <div class="charge-hint">Default: 0.425% per year of principal — slide to adjust</div>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-calc" onclick="calculateEMI()"><i class="fas fa-calculator"></i> Calculate EMI</button>
      <button class="btn btn-reset" onclick="resetForm()"><i class="fas fa-redo"></i> Reset</button>
      <button class="btn btn-print" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
    </div>
    <div class="error-msg" id="errorMsg"></div>
  </div>

  <!-- RESULTS -->
  <div id="results">
    <!-- SUMMARY CARDS -->
    <div class="summary-grid" style="margin-top:28px;">
      <div class="sum-card highlight">
        <div class="label">Monthly EMI</div>
        <div class="value" id="rEmi">—</div>
        <div class="sub">per month</div>
      </div>
      <div class="sum-card">
        <div class="label">Total Interest</div>
        <div class="value" id="rInterest">—</div>
        <div class="sub" id="rInterestPct">—</div>
      </div>
      <div class="sum-card">
        <div class="label">Total Cost</div>
        <div class="value" id="rTotal">—</div>
        <div class="sub">principal + interest + charges</div>
      </div>
      <div class="sum-card">
        <div class="label">Service Charge</div>
        <div class="value" id="rSc">—</div>
        <div class="sub" id="rScPct">—</div>
      </div>
      <div class="sum-card">
        <div class="label">Insurance Charge</div>
        <div class="value" id="rIc">—</div>
        <div class="sub" id="rIcYears">—</div>
      </div>
      <div class="sum-card">
        <div class="label">Total Charges</div>
        <div class="value" id="rCharges">—</div>
        <div class="sub">service + insurance</div>
      </div>
    </div>

    <!-- CHART + BREAKDOWN -->
    <div class="visual-row">
      <div class="chart-card">
        <h3><i class="fas fa-chart-pie" style="color:var(--teal);margin-right:8px"></i>Cost Breakdown</h3>
        <div class="chart-wrap"><canvas id="donutChart"></canvas></div>
      </div>
      <div class="chart-card">
        <h3><i class="fas fa-layer-group" style="color:var(--violet);margin-right:8px"></i>Breakdown Detail</h3>
        <div class="breakdown-list" id="breakdownList"></div>
      </div>
    </div>

    <!-- AMORTIZATION TABLE -->
    <div class="table-section">
      <div class="table-head">
        <h3><i class="fas fa-table" style="color:var(--teal);margin-right:8px"></i>Amortization Schedule</h3>
        <span style="font-size:.78rem;color:var(--muted)" id="tableInfo"></span>
      </div>
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Payment Date</th>
              <th>Principal Paid</th>
              <th>Interest Paid</th>
              <th>Total EMI</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
let donutChart = null;

function fmt(n){
  // Nepal comma format: 12,34,567.00
  const parts = Math.abs(n).toFixed(2).split('.');
  const int   = parts[0];
  const dec   = parts[1];
  let result  = '';
  let len     = int.length;
  if(len<=3){ result=int; }
  else{
    result = int.slice(-3);
    let rem = int.slice(0,len-3);
    while(rem.length>2){result=rem.slice(-2)+','+result;rem=rem.slice(0,rem.length-2);}
    if(rem.length) result=rem+','+result;
  }
  return 'Rs '+result+'.'+dec;
}

function showError(msg){
  const el=document.getElementById('errorMsg');
  el.textContent=msg; el.style.display='block';
  setTimeout(()=>el.style.display='none',4000);
}

function calculateEMI(){
  const p = parseFloat(document.getElementById('principal').value);
  const annualRate = parseFloat(document.getElementById('rate').value);
  const n = parseInt(document.getElementById('months').value);
  const sc = parseFloat(document.getElementById('scRange').value)/100;
  const ic = parseFloat(document.getElementById('icRange').value)/100;

  if(!p||!annualRate||!n||p<=0||annualRate<=0||n<=0){
    showError('⚠️  Please enter valid positive values for all fields.');
    return;
  }
  if(n>600){ showError('⚠️  Tenure should be 600 months (50 years) or less.'); return; }

  const r   = annualRate/12/100;
  const emi = p*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
  const totalInterest = emi*n - p;
  const serviceCharge = p*sc;
  const insuranceCharge = p*ic*Math.ceil(n/12);
  const totalCharges = serviceCharge+insuranceCharge;
  const totalCost = p+totalInterest+totalCharges;

  // Summary cards
  document.getElementById('rEmi').textContent      = fmt(emi);
  document.getElementById('rInterest').textContent  = fmt(totalInterest);
  document.getElementById('rInterestPct').textContent = ((totalInterest/p)*100).toFixed(1)+'% of principal';
  document.getElementById('rTotal').textContent     = fmt(totalCost);
  document.getElementById('rSc').textContent        = fmt(serviceCharge);
  document.getElementById('rScPct').textContent     = (sc*100).toFixed(2)+'% of principal';
  document.getElementById('rIc').textContent        = fmt(insuranceCharge);
  document.getElementById('rIcYears').textContent   = (ic*100).toFixed(3)+'% × '+Math.ceil(n/12)+' year(s)';
  document.getElementById('rCharges').textContent   = fmt(totalCharges);

  // Donut chart
  if(donutChart) donutChart.destroy();
  donutChart = new Chart(document.getElementById('donutChart'),{
    type:'doughnut',
    data:{
      labels:['Principal','Interest','Service Charge','Insurance'],
      datasets:[{data:[p,totalInterest,serviceCharge,insuranceCharge],
        backgroundColor:['#7c5cfc','#00e5cc','#ffd166','#ff6584'],
        borderColor:'#0e1428',borderWidth:3,hoverOffset:6}]
    },
    options:{
      cutout:'68%',responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{callbacks:{
        label:ctx=>' '+fmt(ctx.parsed)+' ('+((ctx.parsed/totalCost)*100).toFixed(1)+'%)'
      }}}
    }
  });

  // Breakdown list
  const items=[
    {label:'Principal',value:p,color:'#7c5cfc'},
    {label:'Total Interest',value:totalInterest,color:'#00e5cc'},
    {label:'Service Charge',value:serviceCharge,color:'#ffd166'},
    {label:'Insurance',value:insuranceCharge,color:'#ff6584'},
  ];
  document.getElementById('breakdownList').innerHTML = items.map(it=>`
    <div class="bk-item" style="flex-direction:column;align-items:flex-start">
      <div style="display:flex;justify-content:space-between;width:100%;margin-bottom:5px">
        <span style="display:flex;align-items:center;gap:8px">
          <span class="bk-dot" style="background:${it.color}"></span>
          <span class="bk-label">${it.label}</span>
        </span>
        <span class="bk-value">${fmt(it.value)}</span>
      </div>
      <div class="bk-bar-wrap"><div class="bk-bar" style="width:${(it.value/totalCost*100).toFixed(1)}%;background:${it.color}"></div></div>
    </div>`).join('');

  // Table
  let remaining = p;
  const startDate = new Date();
  let rows = '';
  for(let i=1;i<=n;i++){
    const intPaid  = remaining*r;
    const prinPaid = emi-intPaid;
    remaining     -= prinPaid;
    const pd = new Date(startDate);
    pd.setMonth(pd.getMonth()+i-1);
    const dateStr = pd.toISOString().split('T')[0];
    const bal = remaining<0.01?0:remaining;
    rows += `<tr>
      <td>${i}</td>
      <td style="text-align:center;color:var(--muted)">${dateStr}</td>
      <td>${fmt(prinPaid)}</td>
      <td>${fmt(intPaid)}</td>
      <td style="color:var(--teal);font-weight:600">${fmt(emi)}</td>
      <td style="color:var(--muted)">${fmt(bal)}</td>
    </tr>`;
  }
  document.getElementById('tableBody').innerHTML = rows;
  document.getElementById('tableInfo').textContent = n+' payments · '+fmt(emi)+' / month';

  // Show results
  const res = document.getElementById('results');
  res.style.display = 'block';
  res.scrollIntoView({behavior:'smooth',block:'start'});
}

function resetForm(){
  ['principal','rate','months'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('scRange').value=1.3;
  document.getElementById('scDisplay').textContent='1.30%';
  document.getElementById('icRange').value=0.425;
  document.getElementById('icDisplay').textContent='0.425%';
  document.getElementById('results').style.display='none';
  if(donutChart){donutChart.destroy();donutChart=null;}
  document.getElementById('errorMsg').style.display='none';
  window.scrollTo({top:0,behavior:'smooth'});
}

// Enter key
document.addEventListener('keypress',e=>{if(e.key==='Enter')calculateEMI();});
</script>
</body>
</html>
